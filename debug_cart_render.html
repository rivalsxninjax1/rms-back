<!DOCTYPE html>
<html>
<head>
    <title>Debug Cart Render</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; border-left: 4px solid #007bff; }
        .error { border-left-color: #dc3545; }
        .success { border-left-color: #28a745; }
        .warning { border-left-color: #ffc107; }
    </style>
</head>
<body>
    <h1>Cart Render Debug</h1>
    
    <div id="cart-items" style="border: 1px solid #eee; padding: 20px; margin: 20px 0;">
        <!-- Cart items will be rendered here -->
    </div>
    
    <div id="debug-output"></div>
    
    <button onclick="testCartRender()">Test Cart Render</button>
    <button onclick="checkScripts()">Check Scripts</button>
    <button onclick="clearLogs()">Clear Logs</button>
    
    <script>
        // Override console.log to capture output
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        const logs = [];
        
        function addLog(type, message) {
            const timestamp = new Date().toLocaleTimeString();
            logs.push({ type, message, timestamp });
            updateDebugOutput();
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addLog('log', args.join(' '));
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addLog('error', args.join(' '));
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addLog('warning', args.join(' '));
        };
        
        function updateDebugOutput() {
            const output = document.getElementById('debug-output');
            output.innerHTML = logs.map(log => 
                `<div class="log ${log.type}">[${log.timestamp}] ${log.message}</div>`
            ).join('');
            output.scrollTop = output.scrollHeight;
        }
        
        function clearLogs() {
            logs.length = 0;
            updateDebugOutput();
        }
        
        function checkScripts() {
            console.log('=== Script Check ===');
            console.log('cartApiGet available:', typeof window.cartApiGet);
            console.log('cartApiAdd available:', typeof window.cartApiAdd);
            console.log('cartApiRemove available:', typeof window.cartApiRemove);
            console.log('renderCartBadges available:', typeof window.renderCartBadges);
            console.log('__CART_RENDER_BOUND__:', window.__CART_RENDER_BOUND__);
            
            // Check if cart-render.js functions are available
            const scripts = Array.from(document.scripts).map(s => s.src);
            console.log('Loaded scripts:', scripts.filter(s => s.includes('cart')));
        }
        
        async function testCartRender() {
            console.log('=== Testing Cart Render ===');
            
            // Add test data to localStorage
            const testCart = {
                items: {
                    "1": { name: "Debug Pizza", qty: 2, price: 15.99 },
                    "2": { name: "Debug Burger", qty: 1, price: 12.50 }
                }
            };
            
            localStorage.setItem('cart_v1', JSON.stringify(testCart));
            console.log('Added test data to localStorage');
            
            // Check if cartApiGet works
            if (typeof window.cartApiGet === 'function') {
                try {
                    const result = await window.cartApiGet();
                    console.log('cartApiGet result:', result);
                    
                    if (result.items && result.items.length > 0) {
                        console.log('Found', result.items.length, 'items in cart');
                    } else {
                        console.log('No items found in cart');
                    }
                } catch (error) {
                    console.error('cartApiGet error:', error);
                }
            } else {
                console.error('cartApiGet function not available');
            }
            
            // Check cart-items div
            const cartDiv = document.getElementById('cart-items');
            if (cartDiv) {
                console.log('cart-items div found, current content:', cartDiv.innerHTML.length, 'characters');
            } else {
                console.error('cart-items div not found');
            }
        }
        
        // Log when page loads
        window.addEventListener('load', () => {
            console.log('Page loaded');
            checkScripts();
        });
        
        // Log when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM ready');
        });
        
        console.log('Debug script initialized');
    </script>
</body>
</html>