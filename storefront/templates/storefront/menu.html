<!-- FILE: storefront/templates/storefront/menu.html -->
{% extends "storefront/base.html" %}
{% load static %}
{% block title %}Menu â€“ {{ SITE_NAME|default:"RMS" }}{% endblock %}

{% block content %}
  <div class="container" style="max-width:1060px;margin:24px auto;">
    <h1 style="margin-bottom:16px;">Our Menu</h1>

    {% if categories %}
      <!-- Category filter buttons -->
      <div style="margin-bottom:20px;">
        <button onclick="filterByCategory('all')" class="category-filter active">All Items</button>
        {% for category in categories %}
          <button onclick="filterByCategory('{{ category.id }}')" class="category-filter">{{ category.name }}</button>
        {% endfor %}
      </div>
    {% endif %}

    {% if items %}
      <div class="grid" style="display:grid;grid-template-columns:repeat(3,1fr);gap:16px;">
        {% for item in items %}
          <div class="card" data-category="{{ item.category_id|default:'all' }}" style="border:1px solid #eee;border-radius:12px;overflow:hidden;background:#fff;">
            <a href="{% url 'storefront:menu-item' item.id %}" style="display:block;color:inherit;text-decoration:none;">
              <div style="aspect-ratio:4/3;background:#f7f7f7;display:flex;align-items:center;justify-content:center;">
                {% if item.image %}
                  <img src="{{ item.image.url }}" alt="{{ item.name }}" style="width:100%;height:100%;object-fit:cover;">
                {% else %}
                  <img src="{% static 'storefront/img/placeholder.svg' %}" alt="Menu Item" style="width:60%;opacity:.6;">
                {% endif %}
              </div>
            </a>
            <div style="padding:16px;">
              <div style="margin-bottom:12px;">
                <div style="font-weight:600;font-size:16px;margin-bottom:4px;">{{ item.name }}</div>
                <div class="muted" style="font-size:14px;color:#666;margin-bottom:8px;">
                  {{ item.description|truncatewords:10 }}
                </div>
                <div style="font-size:18px;font-weight:bold;color:#333;">
                  {{ DEFAULT_CURRENCY|default:"NPR" }} {{ item.price }}
                </div>
              </div>
              <div style="display:flex;gap:8px;margin-top:12px;">
                <a href="{% url 'storefront:menu-item' item.id %}" 
                   class="btn btn-secondary" 
                   style="flex:1;text-align:center;padding:8px 12px;border:1px solid #ddd;background:#f8f9fa;text-decoration:none;border-radius:6px;">
                  View
                </a>
                <!-- FIX: align data attributes with cart.js expectations -->
                <button
                  class="btn btn-primary add-to-cart"
                  data-add-to-cart
                  data-menu-id="{{ item.id }}"
                  data-name="{{ item.name|escape }}"
                  data-price="{{ item.price }}"
                  data-image="{% if item.image %}{{ item.image.url }}{% endif %}"
                  style="flex:1;text-align:center;padding:8px 12px;background:#007bff;color:#fff;border:none;border-radius:6px;cursor:pointer;"
                >
                  Add to Cart
                </button>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p>No items available.</p>
    {% endif %}
  </div>

  <script>
    function filterByCategory(catId) {
      const cards = document.querySelectorAll('.card[data-category]');
      cards.forEach(card => {
        if (catId === 'all' || String(card.getAttribute('data-category')) === String(catId)) {
          card.style.display = 'block';
        } else {
          card.style.display = 'none';
        }
      });
    }
  </script>

  <style>
    .category-filter {
      padding: 8px 16px;
      margin: 0 4px 4px 0;
      border: 1px solid #ddd;
      background: #f8f9fa;
      border-radius: 20px;
      cursor: pointer;
    }
    .category-filter.active { background:#e9ecef; }
    .btn { transition: all .15s ease; }
    .btn:hover { transform: translateY(-1px); }
  </style>
{% endblock %}
