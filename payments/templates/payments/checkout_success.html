<!-- FILE: payments/templates/payments/checkout_success.html -->
{% load static %}
{% block title %}Payment Successful{% endblock %}

<div class="container" style="max-width: 760px; margin: 24px auto;">
  <div style="border:1px solid #e5e7eb; border-radius:12px; padding:24px;">
    <h1 style="margin:0 0 12px;">✅ Payment Successful</h1>
    {% if order %}
      <p style="margin:0 0 6px;">Order <strong>#{{ order.id }}</strong> has been paid. Thank you!</p>
    {% else %}
      <p style="margin:0 0 6px;">Payment received. Thank you!</p>
    {% endif %}

    <div style="margin:16px 0;">
      {% if invoice_url %}
        <a href="{{ invoice_url }}" class="btn">Download Invoice (PDF)</a>
      {% elif order and order.invoice_pdf %}
        <a href="{{ order.invoice_pdf.url }}" class="btn">Download Invoice (PDF)</a>
      {% endif %}
    </div>

    <div style="margin-top:12px;">
      <a href="{% url 'storefront:my_orders' %}" class="btn">Go to My Orders</a>
      <a href="{% url 'storefront:menu' %}" class="btn btn-secondary" style="margin-left:8px;">Continue Shopping</a>
    </div>
  </div>
</div>

<script>
  // ✅ Clear ONLY the cart after payment success
  try {
    // Clear server-side session cart keys (does not flush entire session)
    fetch("/api/orders/cart/reset_session/", { method:"POST", credentials:"include" }).catch(()=>{});
    // Clear any client-side mirror
    localStorage.removeItem("cart");
    localStorage.removeItem("applied_coupon");
  } catch (e) {}
</script>
